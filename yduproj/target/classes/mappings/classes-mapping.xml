<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ydu.biz.classes.impl.ClassMapper">



	<insert id="insertClass" parameterType="classStatus">
		<selectKey keyProperty="classNo" resultType="int" order="BEFORE">
			SELECT NVL(MAX(CLASS_NO),0) + 1 FROM CLASSES
		</selectKey>
	<![CDATA[
		INSERT INTO CLASSS_STATUS( CLASS_NO, STUDENT_CODE, OPEN_CLASS, REPEAT, CLASS_GRADE) 
		VALUES(#{classNo}, #{studentCode}, #{openClass}, #{repeat}, #{classGrade})
	]]>
	</insert>
	
	<delete id="deleteClass" parameterType="classStatus">
	<![CDATA[
		DELETE CLASSES
		WHERE CLASS_NO = #{classNo}
	]]>
	</delete>
	
	<select id="getClassesList" resultType="map">
		SELECT 	n.open_class as "openClass",
        c.class_title as "classTitle",
        p.name as "name",
        n.class_time as "classTime",
        n.class_room as "classRoom",
        d.small_codename as "smallCodename",
        n.student_limit as "studentLimit"
		FROM CLASS_LIST c,
		NEW_CLASS n,
		PROFESSOR p,
		CODE d
		WHERE c.class_code = n.class_code and
		n.prof_code = p.prof_code and
		c.major = d.small_code
	</select>

	<select id="getSelStuClassesList" parameterType="classStatus" resultType="classStatus">
		SELECT 	s.CLASS_NO as "classNo",
        s.ST_CODE as "stCode",
        s.OPEN_CLASS as "openClass",
        s.REPEAT as "repeat",
        s.CLASS_GRADE as "classGrade",
        s.CLASS_TIME as "classTime",
        l.class_title as "classTitle"
		FROM CLASS_STATUS s, CLASS_LIST l, new_class n
		WHERE s.ST_CODE = #{student_code} and
			s.open_class=n.open_class and
			n.class_code=l.class_code		
	</select>
 
<select id="getClasses" resultType="map">
		SELECT 	n.open_class as "openClass",
        c.class_title as "classTitle",
        p.name as "name",
        n.class_time as "classTime",
        n.class_room as "classRoom",
        d.bic_codename as "bicCodename",
        c.class_credit as "classCredit",
        l.plan_week1 as "planWeek1",
         l.plan_week2 as "planWeek2",
          l.plan_week3 as "planWeek3",
           l.plan_week4 as "planWeek4",
            l.plan_week5 as "planWeek5",
             l.plan_week6 as "planWeek6",
              l.plan_week7 as "planWeek7",
               l.plan_week8 as "planWeek8",
                l.plan_week9 as "planWeek9",
                 l.plan_week10 as "planWeek10",
                  l.plan_week11 as "planWeek11",
                   l.plan_week12 as "planWeek12",
                    l.plan_week13 as "planWeek13",
                     l.plan_week14 as "planWeek14",
                      l.plan_week15 as "planWeek15",
                       l.plan_week16 as "planWeek16"
		FROM NEW_CLASS n,
		PROFESSOR p,
		CODE d,
		CLASS_LIST c,
		CLASS_PLAN l
		WHERE c.class_code = n.class_code and
		n.prof_code = p.prof_code and
		c.property = d.bic_code and 
		n.open_class = #{openClass}
	</select>




</mapper>
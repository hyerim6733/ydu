<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ydu.biz.classes.impl.ClassMapper">



	<insert id="insertClass" parameterType="classStatus">
		<selectKey keyProperty="classNo" resultType="int" order="BEFORE">
			SELECT NVL(MAX(CLASS_NO),0) + 1 FROM CLASSES
		</selectKey>
	<![CDATA[
		INSERT INTO CLASSS_STATUS( CLASS_NO, STUDENT_CODE, OPEN_CLASS, REPEAT, CLASS_GRADE) 
		VALUES(#{classNo}, #{studentCode}, #{openClass}, #{repeat}, #{classGrade})
	]]>
	</insert>
	
	<delete id="deleteClass" parameterType="classStatus">
	<![CDATA[
		DELETE CLASSES
		WHERE CLASS_NO = #{classNo}
	]]>
	</delete>
	
	<select id="getClassesList" resultType="map">
		SELECT 	n.open_class as "openClass",
        c.class_title as "classTitle",
        p.name as "name",
        n.class_time as "classTime",
        n.class_room as "classRoom",
        d.small_codename as "smallCodename",
        n.student_limit as "studentLimit"
		FROM CLASS_LIST c,
		NEW_CLASS n,
		PROFESSOR p,
		CODE d
		WHERE c.class_code = n.class_code and
		n.prof_code = p.prof_code and
		c.major = d.small_code
	</select>

	<select id="getSelStuClassesList" parameterType="classStatus" resultType="classStatus">
		SELECT 	s.CLASS_NO as "classNo",
        s.ST_CODE as "stCode",
        s.OPEN_CLASS as "openClass",
        s.REPEAT as "repeat",
        s.CLASS_GRADE as "classGrade",
        s.CLASS_TIME as "classTime",
        l.class_title as "classTitle"
		FROM CLASS_STATUS s, CLASS_LIST l, new_class n
		WHERE s.ST_CODE = #{student_code} and
			s.open_class=n.open_class and
			n.class_code=l.class_code		

 
	</select>


</mapper>